<html>

<head>
    <script>
        // The localDatabase of articles
        let db = [
            {
                id: 11,
                article: "programming is great",
                name: "programming article 11",
                tags: ["progamming"]
            },
            {
                id: 12,
                article: "programming is great",
                name: "programming article 12",
                tags: ["progamming"]
            },
            {
                id: 13,
                article: "programming is great",
                name: "programming article 13",
                tags: ["progamming"]
            },
            {
                id: 14,
                article: "programming is great",
                name: "programming article 14",
                tags: ["progamming"]
            },
            {
                id: 15,
                article: "programming is great",
                name: "programming article 15",
                tags: ["progamming"]
            },
            {
                id: 16,
                article: "programming is great",
                name: "programming article 16",
                tags: ["progamming"]
            },
            {
                id: 17,
                article: "programming is great",
                name: "programming article 17",
                tags: ["progamming"]
            },
            {
                id: 18,
                article: "programming is great",
                name: "programming article 18",
                tags: ["progamming"]
            },
            {
                id: 19,
                article: "programming is great",
                name: "programming article 19",
                tags: ["progamming", "life"]
            },
            {
                id: 20,
                article: "programming is great",
                name: "programming article 20",
                tags: ["progamming"]
            },
            {
                id: 21,
                article: "programming is great",
                name: "programming article 21",
                tags: ["progamming"]
            },
            {
                id: 22,
                article: "programming is great",
                name: "programming article 22",
                tags: ["progamming"]
            },
            {
                id: 23,
                article: "programming is great",
                name: "programming article 23",
                tags: ["progamming"]
            },
            {
                id: 24,
                article: "programming is great",
                name: "programming article 24",
                tags: ["progamming"]
            },
            {
                id: 25,
                article: "programming is great",
                name: "programming article 25",
                tags: ["progamming"]
            },
            {
                id: 26,
                article: "programming is great",
                name: "programming article 26",
                tags: ["progamming"]
            },
            {
                id: 27,
                article: "programming is great",
                name: "programming article 27",
                tags: ["progamming"]
            },
            {
                id: 28,
                article: "programming is great",
                name: "programming article 28",
                tags: ["progamming"]
            },
            {
                id: 29,
                article: "programming is great",
                name: "programming article 29",
                tags: ["progamming"]
            },
            {
                id: 30,
                article: "programming is great",
                name: "programming article 30",
                tags: ["progamming"]
            },
            {
                id: 31,
                article: "programming is great",
                name: "programming article 31",
                tags: ["progamming"]
            },
        ];

        // Load db from localStorage
        function loadDb () {
            if (localStorage.getItem('localDatabase') !== null) {
                db = JSON.parse(localStorage.getItem('localDatabase'));
            }
        }
        loadDb();
        </script>

    <!-- Import like button -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <style>
        .fa {
            font-size: 50px;
            cursor: pointer;
            user-select: none;
            color: black;
        }

        .fa:hover {
            transform: scale(1.3);
        }

        body {
            background-color: rgb(153, 161, 177);
        }
    </style>

    <script src="paginator.js" type="text/javascript"></script>
    <script src="editArticle.js" type="text/javascript"></script>
    <script src="likeButton.js" type="text/javascript"></script>
</head>

<body>    
    <div style="display: grid; grid-template-columns: [first] 300px [content] auto [last] 300px [end];">
        <div id="pageContent" style="grid-column: content">
        </div>
</div>


<script>
    function populateStorage() {
        localStorage.setItem('localDatabase', JSON.stringify(db));
        let myDb = JSON.parse(localStorage.getItem('localDatabase'));
    }
    
    // Check the window.location.hash to determine what page to show
    function checkTheHash() {
        
        // Clear #pageContent
        document.getElementById('pageContent').innerHTML = "";

        if (window.location.hash == "") {
            
            function onPageChange(firstIndex, lastIndex) {
                document.getElementById('pageContent').innerHTML = "";

                let articleList = new ArticleApp(db.slice(firstIndex, lastIndex))
                let articleListEl = articleList.render();
                document.getElementById('pageContent').append(articleListEl)
                
                let paginatorEl = paginator.render();
                document.getElementById("pageContent").append(paginatorEl)
                
            }
            
            let paginator = new Paginator(db.length, 5, onPageChange )
            onPageChange(0, 5);
        }
        
        let articleIndex = "";
        db.forEach(function(art, index) {
            if (art.id == window.location.hash.slice(1)) {
                articleIndex = index
            } 
        })
        
        if (window.location.hash.endsWith("edit")) {
            let artId = window.location.hash.slice(1, 3);
            let art = "";
            for (let article in db) {
                if (db[article].id == artId) {
                    art = db[article]
                }
            }
            let editApp = new EditArticle(art)
            let editEl = editApp.render(art);
            document.getElementById("pageContent").append(editEl)
        }

        // Show an individual article
        if (db[articleIndex] !== undefined) {
            detailEl = new Article(db[articleIndex]).render();
            likeButton = new LikeButton().render();

            let pageContentSelector = document.querySelector('#pageContent');
            pageContentSelector.innerHTML = "";
            pageContentSelector.append(detailEl);
            pageContentSelector.append(likeButton);            
        }
    }

    // Listen for hashchange
    window.addEventListener("hashchange", checkTheHash);

    class Article {
        constructor(article, onBackClick, onEditClick) {
            this.article = article;
            this.onBackClick = onBackClick;
            this.onEditClickLocal = onEditClick;
        }
        
        // Render an individual article
        render() {
            let detailEl = document.createElement('p');

            let counter = 0;

            detailEl.innerHTML = `
            <h2>Article #${this.article.id} ${this.article.name}</h2>
            <p>${this.article.article}</p>
            <p>${this.article.tags}</p>
            <p><button id="edit">Edit</button></p>
            <p><button id="back">Back</button></p>
            `           
            
            detailEl.querySelector('#edit').onclick = (ev => {
                window.location.hash = this.article.id + "edit";

            })
            
            detailEl.querySelector('#back').onclick = (ev => {
                window.location.hash = "";

            })

            return detailEl

        }
    }

    class ArticleApp {
        constructor(articles) {
            //this.el_tag = document.querySelector('#pageContent');
            this.articles = articles;

        }

        render() {
            let renderEl = document.createElement("div");
            renderEl.innerHTML = "";
            let res = [];
            this.articles.forEach(art => {
                let el = document.createElement('p');
                el.innerHTML = `<a href="#${art.id}">${art.name}</a>`
                res.push(el)
            });

            res.forEach(el => {
                renderEl.append(el)
            });

            return renderEl;
    
        }

    }
    
    checkTheHash();

</script>
</body>

</html>