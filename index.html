<html>

<head>
    <script>
        let db = [
            {
                id: 11,
                article: "programming is great",
                name: "programming article 11",
                tags: ["progamming"]
            },
            {
                id: 12,
                article: "programming is great",
                name: "programming article 12",
                tags: ["progamming"]
            },
            {
                id: 13,
                article: "programming is great",
                name: "programming article 13",
                tags: ["progamming"]
            },
            {
                id: 14,
                article: "programming is great",
                name: "programming article 14",
                tags: ["progamming"]
            },
            {
                id: 15,
                article: "programming is great",
                name: "programming article 15",
                tags: ["progamming"]
            },
            {
                id: 16,
                article: "programming is great",
                name: "programming article 16",
                tags: ["progamming"]
            },
            {
                id: 17,
                article: "programming is great",
                name: "programming article 17",
                tags: ["progamming"]
            },
            {
                id: 18,
                article: "programming is great",
                name: "programming article 18",
                tags: ["progamming"]
            },
            {
                id: 19,
                article: "programming is great",
                name: "programming article 19",
                tags: ["progamming", "life"]
            },
            {
                id: 20,
                article: "programming is great",
                name: "programming article 20",
                tags: ["progamming", "death"]
            },
        ];
    </script>

</head>

<body>
<div style="display: grid; grid-template-columns: [first] 300px [content] auto [last] 300px [end];">
    <h1 style="grid-column: content">Hello World. </h1>
    <div id="articles" style="grid-column: content"></div>
</div>

<script>
    function checkTheHash() {
        console.log('location changed', window.location.hash);
        if (window.location.hash == "") {
            let articleList = new ArticleApp(db);
            articleList.render();
        }
        
        let articleIndex = "";
        db.forEach(function(art, index) {
            if (art.id == window.location.hash.slice(1)) {
                articleIndex = index
            } 
        })

        if (db[articleIndex] !== undefined) {
            detailEl = new Article(db[articleIndex]).render()
            let articlesSelector = document.querySelector('#articles');
            articlesSelector.innerHTML = "";
            articlesSelector.append(detailEl);
        }
    }

    window.addEventListener("hashchange", checkTheHash);
    

    class Article {
        constructor(article, onBackClick, onEditClick) {
            this.article = article;
            this.onBackClick = onBackClick;
            this.onEditClickLocal = onEditClick;
        }

        render() {
            let detailEl = document.createElement('p');

            detailEl.innerHTML = `
            <h2>Article #${this.article.id} ${this.article.name}</h2>
            <p>${this.article.article}</p>
            <p>${this.article.tags.join(', ')}</p>
            <p><button id="edit">Edit</button></p>
            <p><button id="back">Back</button></p>
            `
            detailEl.querySelector('#edit').onclick = (ev => {
                this.onEditClickLocal(this.article)
            })
            detailEl.querySelector('#back').onclick = (ev => {
                // this.onBackClick()
                window.location.hash = "";

            })
            return detailEl

        }
    }

    class ArticleApp {
        constructor(articles) {
            this.el_tag = document.querySelector('#articles');
            this.articles = articles;

        }

        render() {
            this.el_tag.innerHTML = ""
            let res = [];
            this.articles.forEach(art => {
                let el = document.createElement('p');
                el.innerHTML = `<a href="#${art.id}">${art.name}</a>`
                // el.onclick = (ev => {
                //     let articleComponent = new Article(art, () => this.render(), (art) => this.onEditClick(art));
                //     this.el_tag.innerHTML = ""
                //     this.el_tag.append(articleComponent.render())
                // })
                // // Changed to use navigation API above 
                res.push(el)
            });

            res.forEach(el => {
                this.el_tag.append(el)
            })
            //window.location.hash = "";
        }

        onEditClick(art) {
            // input for each field(name, article, tags)
            // onSave button (take value of each input and put it into the article)
            // render the page again with updated fields
            this.el_tag.innerHTML = ""
            
            let user_editable = ["name", "article", "tags"];
            user_editable.forEach(editable => {
                let el = document.createElement('p');
                el.innerHTML = `<input type="text" id="${editable}" value="${art[editable]}">`
                this.el_tag.append(el)
            })
            let saveButton = document.createElement('p');
            saveButton.innerHTML = "<p><button class='button' id='save'>Save</button></p>"
            this.el_tag.append(saveButton);

            let backButton = document.createElement('p');
            backButton.innerHTML = "<p><button class='button' id='back'>back</button></p>"
            this.el_tag.append(backButton);
            
            saveButton.querySelector('#save').onclick = (ev => {
                let newName = document.getElementById('name').value;
                let newArticle = document.getElementById('article').value;
                let newTags = document.getElementById('tags').value;
                art.name = newName
                art.article = newArticle
                art.newTags = tags
                let articleComponent = new Article(art, () => this.render(), (art) => this.onEditClick(art));
                this.el_tag.innerHTML = ""
                this.el_tag.append(articleComponent.render())

            })

            backButton.querySelector('#back').onclick = (ev => {
                    let articleComponent = new Article(art, () => this.render(), (art) => this.onEditClick(art));
                    this.el_tag.innerHTML = ""
                    this.el_tag.append(articleComponent.render())
            })
        
        }

    }

    
    checkTheHash();

</script>
</body>

</html>